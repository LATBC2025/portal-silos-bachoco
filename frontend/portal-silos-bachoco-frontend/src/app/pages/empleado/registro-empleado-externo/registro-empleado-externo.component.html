<div class="container-home">
  <app-header class="fade-in component-header"></app-header>
</div>
<mat-card class="main-card">
  <mat-card-content>
    <div class="card shadow">
      <div class="card-header text-white">
        <h4 class="mb-0" style="text-align: center;">Registro de Proveedor</h4>
      </div>
      <div class="card-body card-min">
        <form [formGroup]="formEmpleadoExterno">
          <div class="row mb-3">
            <div class="col-md-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input type="text" class="form-control" formControlName="nombre" id="nombre"
                placeholder="Ingrese el nombre" required>
              <div class="text-danger size-text-error" >
                @if (formEmpleadoExterno.get('nombre')?.invalid && formEmpleadoExterno.get('nombre')?.touched) {
                @if (formEmpleadoExterno.get('nombre')?.errors?.['required']) {
                Campo requerido.
                }
                 @if (formEmpleadoExterno.get('nombre')?.errors?.['pattern']) {
                Formato inválido.
                }
                }
              </div>
            </div>
            <div class="col-md-3">
              <label for="rfc" class="form-label">RFC</label>
              <input type="text" class="form-control" formControlName="rfc" id="rfc" placeholder="Ingrese el nombre"
                required>
              <div class="text-danger size-text-error">
                @if (formEmpleadoExterno.get('rfc')?.invalid && formEmpleadoExterno.get('rfc')?.touched) {
                @if (formEmpleadoExterno.get('rfc')?.errors?.['required']) {
                Campo requerido.
                }
                @if (formEmpleadoExterno.get('rfc')?.errors?.['pattern']) {
                Formato inválido.
                }
                }
              </div>
            </div>
            <div class="col-md-4 mt-3 mt-lg-0">
              <label for="email" class="form-label">Correo Electrónico</label>
              <input type="email" class="form-control" formControlName="correo" id="email"
                placeholder="correo@empresa.com" required>
              <div class="text-danger size-text-error">
                @if (formEmpleadoExterno.get('correo')?.invalid && formEmpleadoExterno.get('correo')?.touched) {
                @if (formEmpleadoExterno.get('correo')?.errors?.['required']) {
                Campo requerido.
                }
                @if (formEmpleadoExterno.get('correo')?.errors?.['invalidEmail']) {
                Formato inválido.
                }
                }
              </div>
            </div>
          </div>
          <div class="col-md-2 mt-3 mt-lg-0">
          <label for="numeroProveedor" class="form-label">Proveedor SAP</label>
          <input
            type="text"
            class="form-control"
            formControlName="numeroProveedor"
            id="numeroProveedor"
            placeholder="Ej. 00012345"
            maxlength="20"
            required
          />
          <div class="text-danger size-text-error">
            @if (formEmpleadoExterno.get('numeroProveedor')?.invalid && formEmpleadoExterno.get('numeroProveedor')?.touched) {
              @if (formEmpleadoExterno.get('numeroProveedor')?.errors?.['required']) {
                Campo requerido.
              }
              @if (formEmpleadoExterno.get('numeroProveedor')?.errors?.['maxlength']) {
                Máx. 30 caracteres.
              }
              @if (formEmpleadoExterno.get('numeroProveedor')?.errors?.['pattern']) {
                Formato inválido.
              }
            }
          </div>
        </div>

          <div class="row mb-3">
            <div class="col-md-4">
              <label for="silo" class="form-label">Silo</label>
              <select class="form-select" formControlName="siloId" id="silo">
                <option value="0">Seleccionar</option>
                @for(item of listSilo;track item.id){
                <option [value]="item.id">{{item.nombre}}</option>
                }
              </select>
              <div class="text-danger size-text-error">
                @if (formEmpleadoExterno.get('siloId')?.invalid && formEmpleadoExterno.get('siloId')?.touched) {
                @if (formEmpleadoExterno.get('siloId')?.errors?.['required']) {
               Campo requerido.
                }
                @if (formEmpleadoExterno.get('siloId')?.errors?.['zeroValue']) {
               Campo requerido.
                }
                }
              </div>
            </div>
            <div class="col-md-6">
              <label for="bodegas" class="form-label">Bodegas</label>

              <select class="form-select" formControlName="bodegasIds" id="bodegas" multiple
                      [disabled]="listBodegas.length === 0">
                @for(item of listBodegas; track item.id){
                  <option [ngValue]="item.id">{{item.nombre}}</option>
                }
              </select>

              <div class="text-danger size-text-error">
                @if (formEmpleadoExterno.get('bodegasIds')?.invalid && formEmpleadoExterno.get('bodegasIds')?.touched) {
                  Campo requerido.
                }
              </div>

              <small class="text-muted">Puedes seleccionar más de una bodega.</small>
            </div>

            <div class="col-md-2 d-grid">
              @if(showBtnUpdate==true){
              <button type="submit" (click)="submmit()" class="btn-custom marg_top_" style="width: 150px;">Registrar</button>
              }@else{
              <button type="submit" (click)="submmitUpdate()" class="btn-custom marg_top_"
                style="width: 150px;">Actualizar</button>
              }
            </div>
          </div>
        </form>

      </div>
    </div>

    <div class="contenedor-con-scroll mt-2 mt-lg-2 ">
      <table class="table table-striped" style="margin-top: 5px;">
        <thead>
          <tr>
            <th scope="col">Id</th>
            <th scope="col">Número Proveedor</th> <!-- ✅ NUEVO -->
            <th scope="col">Nombre</th>
            <th scope="col">Email</th>
            <th scope="col">Silo</th>
            <th scope="col">Guardar/Eliminar</th>
          </tr>
        </thead>
        <tbody>
          @for (empleado of listaEmpleadoExternoFilters; track empleado.id;let i = $index) {
          <tr>
            <td>{{ empleado.id }}</td>
            <td>{{ empleado.numeroProveedor ?? '-' }}</td> <!-- ✅ NUEVO -->
            <td>{{ empleado.nombre }}</td>
            <td>{{ empleado.correo }}</td>
            <td>{{extractNameSilo(empleado.siloId) }}</td>
            <td>
              <button class="btn btn-light" (click)="update(empleado)">
                <fa-icon [icon]="['fas', 'edit']"></fa-icon>
              </button>
              <button class="btn btn-light" (click)="deleteSilo(empleado.id,i)">
                <fa-icon [icon]="['fas', 'trash']"></fa-icon>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between p-2">
      <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize"
        (pageChange)="refreshCountries()">
      </ngb-pagination>

      <select class="form-select" style="width: auto" [(ngModel)]="pageSize" (ngModelChange)="refreshCountries()">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="50">50</option>
        <option [ngValue]="100">100</option>
      </select>
    </div>
  </mat-card-content>
</mat-card>
